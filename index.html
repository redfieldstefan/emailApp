<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset = "utf-8">
    <title>Coolest Email Application Ever</title>
    <style>
      body {
        font-family: sans-serif;
        background: tomato;
        color: white;
      }
      h1 {
        text-align: center;
      }
      ul {
        list-style: none;
        padding: 0;
      }
      textarea{
        width: 100%;
      }
      section {
        width: 50%;
        margin-right: auto;
        margin-left: auto;
      }
    </style>
  </head>
  <body>
    <section class="emailSubmit">
      <h1>Submit your contacts for processing</h1>
      <p>Please use comma separated values</p>
      <textarea name="email" id="emailSubmissions" cols="30" rows="10"></textarea>
      <button id="submit" onClick="emailFormatter()">Submit</button>
    </section>
    <section class="emailList">
      <h2>New Contacts</h2>
      <ul id="contacts">
      </ul>
    </section>
    <section id="errors" >
      <h2>Error</h2>
      <ul id="errorUl">
      </ul>
      <button class="clearErrors" onClick="clearErrors()">Clear Errors</button>
    </section>
    <script>

      'use strict';

      var elements = {
        emailList: document.getElementById('emailSubmissions'),
        errors: document.getElementById('errors'),
        errorUl: document.getElementById('errorUl'),
        input: document.getElementById('emailSubmissions'),
        submitButton: document.getElementById('submit'),
        validList: document.getElementById('contacts'),
      };
     elements.errors.style.display="none";
      var checkStringType = /^[a-zA-Z]+$/;
      var validateEmail = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;

      var removeQuotes = function(string){
        var split = string.split('');
        if(split[0]==='"'){
          split.shift();
          if(split[split.length - 1] === '"') {
            split.pop();
          }
        }
        return split.join('')
      };

      var emailFormatter = function() {
        var splitInput = elements.input.value.split(', ');
        splitInput.forEach(function(item){
          item = removeQuotes(item);
          var splitListItem = item.split(' ');
          var names = [];
          var email = [];
          splitListItem.forEach(function(string){
            if(checkStringType.test(string)) {
              return names.push(string);
            }
            email.push(string);
          });
          if(!validateEmail.test(email[0])){
              errors.style.display="block";
              var errorLi = document.createElement('li');
              errorLi.innerText = names.join(' ') + ' ' + email[0] + " [error parsing email string]";
              elements.errorUl.appendChild(errorLi);
              return
            }
          else {
            var listItem = document.createElement('li');
            listItem.innerText = names.join(' ') + " <" + email[0] + ">";
            elements.validList.appendChild(listItem);
          }
        });
        elements.emailList.value = "";
      };

      var clearErrors = function() {
        while (elements.errorUl.hasChildNodes()) {
          elements.errorUl.removeChild(elements.errorUl.firstChild);
        }
        elements.errors.style.display="none";
      };

    </script>
  </body>
</html>
