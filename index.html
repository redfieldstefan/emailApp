<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset = "utf-8">
    <title>Coolest Email Application Ever</title>
  </head>
  <body>
    <section class="emailSubmit">
      <h1>Submit your contacts for processing</h1>
      <p>Please use comma separated values</p>
      <textarea name="email" id="emailSubmissions" cols="30" rows="10"></textarea>
      <button id="submit">Submit</button>
    </section>
    <section class="emailList">
      <h1>New Contacts</h1>
      <ul id="contacts">

      </ul>
      <section id="errors" >
        <h1>Error</h1>
        <ul id="errorUl">
        </ul>
      </section>
    </section>

    <script>
      document.getElementById('errors').style.display="none";
      var contacts = [];
      var stringType = /^[a-zA-Z]+$/;
      var emailList = document.getElementById('emailSubmissions');
      var validateEmail = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
      var emailFormatter = function() {
        var body = document.getElementsByTagName('body')[0];
        var input = document.getElementById('emailSubmissions');
        splitInput = input.value.split(', ');
        splitInput.forEach(function(item){
          var splitListItem = item.split(' ');
          var names = [];
          var email = [];
          splitListItem.forEach(function(string){
            if(stringType.test(string)) {
              return names.push(string);
            }
            email.push(string);
          });
          console.log(email);
          if(!validateEmail.test(email[0])){
              document.getElementById('errors').style.display="block"
              var errorUl = document.getElementById('errorUl');
              var errorLi = document.createElement('li');
              errorLi.innerText = names.join(' ') + ' ' + email[0] + " [error parsing email string]";
              errorUl.appendChild(errorLi);
              return
            }
          else {
            var validList = document.getElementById('contacts');
            var listItem = document.createElement('li');
            listItem.innerText = names.join(' ') + " <" + email[0] + ">";
            validList.appendChild(listItem);
          }
          // if(contacts.indexOf(item) < 0) {
          //   contacts.push(item);
          //   var validList = document.getElementById('contacts');
          //   var listItem = document.createElement('li');
          //   listItem.innerText = " <" + item + ">";
          // }
          // else alert('contact already exists')
        });
        emailList.value = "";
      };

      var submitButton = document.getElementById('submit')
      submitButton.addEventListener('click', emailFormatter);

    </script>
  </body>
</html>
